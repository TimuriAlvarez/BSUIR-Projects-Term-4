# Computer System Software Labs

## General information

| Information |                                |
|-------------|--------------------------------|
| Year        | 2nd                            |
| Term        | 4th                            |
| Discipline  | Computer System Software       |
| Quantity    | 11                             |
| OS          | Linux (WSL is also acceptable) |

# Lab 1

## Знакомство с Linux (Unix) и средой программирования

### Terms of reference

Освоить эффективную работу с файлами в оболочке и mc:

* Оболочка bash, файловый менеджер mc, стандартное информационное обеспечение (info, man).
* Внешнее знакомство с POSIX-совместимой файловой системой структура ката‒логов, жесткие и символические ссылки, права доступа, монтирование файловых систем, монтирование каталогов (mount, mount --bind).
* Команды и утилиты оболочки man, info, mkdir, touch, rm, rmdir, cd, cat, sort, head, tail, tee, wc, chmod, pwd, ls, lsof, lsblk, lsusb, lscpu, ln, link, unlink, locale, iconv, kill, top, htop, ps, grep, diff, env, file, stat, find, tar, gzip, more, less, printf, time, ...
* Сцепление программ и соединение выходных и входных стандартных потоков.
* Перенаправление вывода stdout и stderr в файлы.
* Экосистема курса (gcc, make, gdb).

# Lab 2

## POSIX-совместимая файловая система

### Terms of reference

Структура ФС, содержимое inode, команды оболочки.

Знакомство с POSIX-совместимой файловой системой opendir(3), readdir(3), ‒closedir(3), fstat(2), readlink(2), symlink(2), link(2), unlink(2), ...

* Разработать программу dirwalk, сканирующую файловую систему и выводящую в stdout информацию в соответствии с опциями программы. Формат вывода аналогичен формату вывода утилиты find.

```
dirwalk [dir] [options]

[dir]	 	— начальный каталог. Если опущен, текущий (./).
[options]	— опции:
			-l	—	только символические ссылки (-type l)
			-d	—	только каталоги (-type d)
			-f	—	только файлы (-type f)
			-s	—	сортировать выход в соответствии с LC_COLLATE
			Если опции ldf опущены, выводятся каталоги, файлы, ссылки, как у find без параметров.
```

# Lab 3

## Понятие процессов

### Terms of reference

Изучение системных вызовов fork(), execve(), getpid(), getppid(), getenv().

Демонстрация навыков работы с процессами.

# Lab 4

## Взаимодействие и синхронизация процессов

### Terms of reference

Синхронизация процессов с помощью сигналов и обработка сигналов таймера.

Задача — управление дочерними процессами и упорядочение вывода в stdout от них, используя сигналы SIGUSR1 и SIGUSR2.

#### Действия родительского процесса

* По нажатию клавиши «`+`» pодительский процесс (`P`) порождает дочерний процесс (`C_k`) и сообщает об этом.
* По нажатию клавиши «`-`» `P` удаляет последний порожденный `C_k`, сообщает об этом и о количестве оставшихся.
* При вводе символа «`k`» `P` удаляет все `C_k` и сообщает об этом.
* При вводе символа «`s`» `P` запрещает всем `C_k` выводить статистику (см. ниже).
* При вводе символа «`g`» `P` разрешает всем `C_k` выводить статистику.
* При вводе символов «`s<num>`» `P` запрещает `C_<num>` выводить статистику.
* При вводе символов «`g<num>`» `P` разрешает `C_<num>` выводить статистику.
* При вводе символов «`p<num>`» `P` запрещает всем `C_k` вывод и запрашивает `C_<num>` вывести свою статистику. По истечению заданного времени (5 с, например), если не введен символ «`g`», разрешает всем `C_k` снова выводить статистику.
* По нажатию клавиши «`q`» `P` удаляет все `C_k`, сообщает об этом и завершается.

#### Действия дочернего процесса

* Дочерний процесс во внешнем цикле заводит будильник (nanosleep(2)) и входит в вечный цикл, в котором в режиме чередования заполняет структуру, содержащую пару переменных типа `int`, значениями `{0, 0}` и `{1, 1}` (см. раздел «Проблемы неатомарного доступа» темы «Сигналы»).
* При получении сигнала от будильника проверяет содержимое структуры, собирает статистику и повторяет тело внешнего цикла.
* Через заданное количество повторений внешнего цикла (например, через 101) дочерний процесс, если ему разрешено, выводит свои `PPID`, `PID` и 4 числа — количество разных пар, зарегистрированных в момент получения сигнала от будильника.
* Вывод осуществляется посимвольно.
* `C_k` запрашивает доступ к stdout у `P` и осуществляет вывод после подтверждения. По завершению вывода `C_k` сообщает `P` об этом.
* Следует подобрать интервал времени ожидания и количество повторений внешнего цикла, чтобы статистика была значимой.

# Lab 5

## Задача производители-потребители для процессов

### Terms of reference

Основной процесс создает очередь сообщений, после чего ожидает и обрабатывает нажатия клавиш, порождая и завершая процессы двух типов —производители и потребители.

Очередь сообщений представляет собой классическую структуру — кольцевой буфер, содержащий указатели на сообщения, и пара указателей на голову и хвост. Помимо этого очередь содержит счетчик добавленных сообщений и счетчик извлеченных.

Производители формируют сообщения и, если в очереди есть место, перемещают их туда, потребители, если в очереди есть сообщения, извлекают их оттуда, обрабатывают и освобождают память с ними связанную.

Для работы используются два семафора для заполнения и извлечения, а также мьютекс или одноместный семафор для монопольного доступа к очереди.

Сообщения имеют следующий формат (размер и смещение в байтах):

| Имя  | Размер           | Смещение | Описание                            |
|------|------------------|----------|-------------------------------------|
| type | 1                | 0        | тип сообщения                       |
| hash | 2                | 1        | контрольные данные                  |
| size | 1                | 3        | длина данных в байтах (от 0 до 256) |
| data | ((size + 3)/4)*4 | 4        | данные сообщения                    |

Производители генерируют сообщения, используя системный генератор rand(3) для size и data. В качестве результата для size используется остаток от деления на 257.
Поскольку байт не может содержать значение size, равное 256, для него используется старший (знаковый) бит поля type. Фактически, этот бит определяет фиксированный размер сообщения, равный 256 бит, поле size при этом игнорируется.

При формировании сообщения контрольные данные формируются из всех элементов. Значение поля hash при вычислении контрольных данных принимается равным нулю. Для расчета контрольных данных можно использовать любой подходящий алгоритм.

После помещения значения в очередь перед освобождением мьютекса очереди производитель инкрементирует счетчик добавленных сообщений. Затем после поднятия семафора выводит строку на stdout, содержащую помимо всего новое значение этого счетчика.

Потребитель, получив доступ к очереди, извлекает сообщение и удаляет его из очереди. Перед освобождением мьютекса очереди инкрементирует счетчик извлеченных сообщений. Затем после поднятия семафора проверяет контрольные данные и выводит строку на stdout, содержащую помимо всего новое значение счетчика извлеченных сообщений.

При получении сигнала о завершении процесс должен завершить свой цикл и только после этого завершиться, не входя в новый.

Следует предусмотреть задержки, чтобы вывод можно было успеть прочитать в процессе работы программы.

# Lab 6

## Потоки исполнение (threads)

### Terms of reference

* Pick image (file format not mentioned) and make it greyscale + save
* Processing should be done in seperate threads (number of threads is not mentioned)
* Also you should do it without using threads
* Check time that it takes to make it with threads and without threads and show this infromation

# Lab 7

## Взаимодействие и синхронизация потоков

### 

# Contributing

Pull requests are welcome. For major changes, please open an issue first to discuss what you would like to change.

# Copyright

This repository is under exclusive copyright.

I do grant each User of GitHub a nonexclusive, worldwide license to use, display, and perform My Content through the GitHub Service and to reproduce My Content solely on GitHub as permitted through GitHub's functionality but that is all. No other licences are provided for Users of GitHub.

© All rights reserved, 2022
